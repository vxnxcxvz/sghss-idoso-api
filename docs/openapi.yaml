openapi: 3.0.3
info:
  title: SGHSS VidaPlus API
  version: 1.0.0
  description: API REST para Plataforma de Suporte ao Cuidado do Idoso (SGHSS VidaPlus).
servers:
  - url: http://localhost:3000
tags:
  - name: Auth
    description: Autenticação e autorização (JWT)
  - name: Pacientes
    description: CRUD de pacientes (RBAC + auditoria)
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    Error:
      type: object
      properties:
        error: { type: string }
        message: { type: string }
    Usuario:
      type: object
      properties:
        id: { type: integer, example: 1 }
        nome: { type: string, example: Maria Silva }
        email: { type: string, format: email, example: maria@teste.com }
        perfil:
          type: string
          enum: [ADMIN, PROFISSIONAL, PACIENTE, CUIDADOR]
          example: ADMIN
        pacienteId: { type: integer, nullable: true, example: null }
    RegisterRequest:
      type: object
      required: [nome, email, senha]
      properties:
        nome: { type: string }
        email: { type: string, format: email }
        senha: { type: string, minLength: 6 }
        tipo:
          type: string
          enum: [PACIENTE, MEDICO, ENFERMEIRO, ADMINISTRADOR]
          default: ADMINISTRADOR
        perfil:
          type: string
          enum: [ADMIN, PROFISSIONAL, PACIENTE, CUIDADOR]
        pacienteId: { type: integer, nullable: true }
    LoginRequest:
      type: object
      required: [email, senha]
      properties:
        email: { type: string, format: email }
        senha: { type: string }
    LoginResponse:
      type: object
      properties:
        message: { type: string }
        token: { type: string }
        expiresIn: { type: string }
paths:
  /api/auth/register:
    post:
      tags: [Auth]
      summary: Registrar usuário
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/RegisterRequest' }
      responses:
        '201':
          description: Usuário criado
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }
                  usuario: { $ref: '#/components/schemas/Usuario' }
        '409':
          description: Email já cadastrado
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Error' }
  /api/auth/login:
    post:
      tags: [Auth]
      summary: Login (JWT)
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/LoginRequest' }
      responses:
        '200':
          description: Login OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/LoginResponse' }
        '401':
          description: Credenciais inválidas
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Error' }
  /api/auth/me:
    get:
      tags: [Auth]
      summary: Retorna dados do usuário logado
      security: [{ bearerAuth: [] }]
      responses:
        '200':
          description: Usuário logado
          content:
            application/json:
              schema:
                type: object
                properties:
                  usuario: { $ref: '#/components/schemas/Usuario' }
        '401':
          description: Token ausente/ inválido
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Error' }
